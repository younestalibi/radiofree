import{r as i,j as k,a as c,g as h}from"./app-3ac34f17.js";import{u as x,a as b,C as I,c as f}from"./Controls-cfdd0a8a.js";import $ from"./Video-57f456a6.js";import{G as p}from"./AgoraRTC_N-production-58e0bf64.js";import"./index.modern-fc57a5cb.js";import"./interopRequireDefault-01ffd8a5.js";import"./hoist-non-react-statics.cjs-f0aac326.js";import"./index-e96305ec.js";import"./TransitionGroup-6445893d.js";import"./assertThisInitialized-a147f0d7.js";import"./createClass-5d1a4de6.js";function B(d){const{setInCall:y,channelName:u,roomId:m}=d,[U,n]=i.useState([]),[j,g]=i.useState(!1),o=x(),{ready:l,tracks:s}=b();return i.useEffect(()=>{let w=async a=>{o.on("user-published",async(t,e)=>{await o.subscribe(t,e),e==="video"&&n(r=>[...r,t]),e==="audio"&&t.audioTrack.play()}),o.on("user-joined",async t=>{console.log(o.remoteUsers.length),console.log(typeof o.remoteUsers.length),await h.patch(`https://law.sohanur.com/api/rooms/${m}`,{connected:o.remoteUsers.length}).then(e=>{console.log(e)}).catch(e=>{console.log(e)}),console.log(t),console.log("===join======="),console.log(o.remoteUsers),console.log("=====join=====")}),o.on("user-left",async t=>{console.log(o.remoteUsers.length),console.log(typeof o.remoteUsers.length),await h.patch(`https://law.sohanur.com/api/rooms/${m}`,{connected:o.remoteUsers.length}).then(e=>{console.log(e)}).catch(e=>{console.log(e)}),console.log(t),console.log("=====left====="),console.log(o.remoteUsers),console.log("======left====")}),o.on("user-unpublished",(t,e)=>{e==="audio"&&t.audioTrack&&t.audioTrack.stop(),e==="video"&&n(r=>r.filter(C=>C.uid!==t.uid))}),o.on("user-left",t=>{n(e=>e.filter(r=>r.uid!==t.uid))});try{await o.join(f.appId,a,f.token,null)}catch{console.log("error")}s&&await o.publish([s[0],s[1]]),g(!0)};if(l&&s)try{w(u)}catch(a){console.log(a)}},[u,o,l,s]),k(p,{container:!0,direction:"column",style:{height:"100%"},children:[l&&s&&c(I,{tracks:s,setStart:g,setInCall:y}),c(p,{item:!0,style:{height:"100%",justifyContent:"center",alignItems:"center",display:"flex"},children:j&&s&&c($,{tracks:s,users:U})})]})}export{B as default};
