import{r as c,j as x,a,g}from"./app-3ae4c5ac.js";import{u as b,a as w,C as I,c as d}from"./Controls-eaa47aa8.js";import $ from"./Video-5a42186f.js";import{G as h}from"./AgoraRTC_N-production-50db3e10.js";import"./index.modern-ff826b6e.js";import"./interopRequireDefault-01ffd8a5.js";import"./hoist-non-react-statics.cjs-d86696ba.js";import"./index-d51599c4.js";import"./TransitionGroup-0b0545c3.js";import"./assertThisInitialized-a147f0d7.js";import"./createClass-5d1a4de6.js";function B(p){const{setInCall:y,channelName:u,roomId:m}=p,[U,n]=c.useState([]),[j,f]=c.useState(!1),o=b(),{ready:l,tracks:s}=w();return c.useEffect(()=>{let C=async i=>{o.on("user-published",async(t,e)=>{await o.subscribe(t,e),e==="video"&&n(r=>[...r,t]),e==="audio"&&t.audioTrack.play()}),o.on("user-joined",async t=>{console.log(o.remoteUsers.length),console.log(typeof o.remoteUsers.length),await g.patch(`https://radiofreesom.com/api/rooms/${m}`,{connected:o.remoteUsers.length}).then(e=>{console.log(e)}).catch(e=>{console.log(e)}),console.log(t),console.log("===join======="),console.log(o.remoteUsers),console.log("=====join=====")}),o.on("user-left",async t=>{console.log(o.remoteUsers.length),console.log(typeof o.remoteUsers.length),await g.patch(`https://radiofreesom.com/api/rooms/${m}`,{connected:o.remoteUsers.length}).then(e=>{console.log(e)}).catch(e=>{console.log(e)}),console.log(t),console.log("=====left====="),console.log(o.remoteUsers),console.log("======left====")}),o.on("user-unpublished",(t,e)=>{e==="audio"&&t.audioTrack&&t.audioTrack.stop(),e==="video"&&n(r=>r.filter(k=>k.uid!==t.uid))}),o.on("user-left",t=>{n(e=>e.filter(r=>r.uid!==t.uid))});try{await o.join(d.appId,i,d.token,null)}catch{console.log("error")}s&&await o.publish([s[0],s[1]]),f(!0)};if(l&&s)try{C(u)}catch(i){console.log(i)}},[u,o,l,s]),x(h,{container:!0,direction:"column",style:{height:"100%"},children:[l&&s&&a(I,{tracks:s,setStart:f,setInCall:y}),a(h,{item:!0,style:{height:"100%",justifyContent:"center",alignItems:"center",display:"flex"},children:j&&s&&a($,{tracks:s,users:U})})]})}export{B as default};
